<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Generator</title>
</head>
<body>
    <h1>Generate and Download File</h1>
    
    <p>Choose a PPMS:</p>
    <label><input type="radio" name="choice" value="option1"> Prof. Chaos</label><br>
    <label><input type="radio" name="choice" value="option2"> Butters</label><br>
    
    
    <textarea id="sampleID" rows="1" cols="20" placeholder="Write sample ID here..."></textarea><br>
    <textarea id="sampleField" rows="1" cols="30" placeholder="Write Field (T) here..."></textarea><br>
    
    
    <p id="dateDisplay"></p>
    <script>
        const today = new Date();

        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2,'0');

        const formattedDate = `${year}${month}${day}`;

        document.getElementById('formattedDate').textContent = formattedDate;
    </script>
    

    
    <textarea id="textContent" rows="10" cols="30" placeholder="Write something here..."></textarea><br>
    <button onclick="downloadFile()">Download</button>

    <script>
        function downloadFile() {
            const sampleField = document.getElementById('sampleField').value;
            const sampleID = document.getElementById('sampleID').value;

            
            const measureString = "WAI WAITFOR 5 0 0 0 0 0\nMVP MOVE -10.000 0 14 \"0.798 Degrees/sec\"\nWAI WAITFOR 10 0 0 1 0 0\nMVP MOVE 370.000 0 14 \"0.798 Degrees/sec\"\nWAI WAITFOR 10 0 0 1 0 0\nMVP MOVE -10.000 0 14 \"0.798 Degrees/sec\"\nWAI WAITFOR 10 0 0 1 0 0\nMVP MOVE 370.000 0 14 \"0.798 Degrees/sec\"\nWAI WAITFOR 10 0 0 1 0 0\nLOG 1 \"\"WAI WAITFOR 10 0 0 0 0 0\n";
            const concludeString = "TMP TEMP 305.000000 12.000000 0\nWAI WAITFOR 10 1 0 0 0 0\nFLD FIELD 0.0 200.0 0 0\nMVP MOVE 90.000 0 0 \"11.970 Degrees/sec\"\nWAI\nWAITFOR 10 0 1 1 0 0\n";

            function generalInitiate(field) {

                const stringA = "MVP MOVE 370.000 0 0 \"11.970 Degrees/sec\"\nWAI WAITFOR 5 0 0 1 0 0\nBRG BRIDGE 3 1000.000 1000.000 1 1 95.0\nWAI WAITFOR 5 0 0 0 0 0\nTMP TEMP 400.000000 12.000000 0\nFLD FIELD 80000.0 200.0 0 0\nWAI WAITFOR 3600 1 1 0 0 0\n";

                if(field === 8) {
                    var stringB = "";
                } else {
                    var stringB = `FLD FIELD ${field * 10000}.0 200.0 0 0\nWAI WAITFOR 1800 0 1 0 0 0\n`; // AHHHHHHHH
                }
                    
                return stringA + stringB;
            }

            function initiateMeasurement(field, temp) {
                const stringA = "TMP TEMP 400.000000 12.000000 0\n";

                if(field === 8) {
                    var stringB = "WAI WAITFOR 1800 1 0 0 0 0\n";
                } else {
                    var stringB = "FLD FIELD 80000.0 200.0 0 0\nWAI WAITFOR 1800 1 1 0 0\n";
                }

                if (temp === 10) {
                    var stringC = "TMP TEMP 20.000000 12.000000 0\nWAI WAITFOR 1800 1 0 0 0 0\n";
                } else {
                    var stringC = "";
                }

                const stringD = `TMP TEMP ${temp}.000000 12.000000 0\nWAI WAITFOR 3600 1 0 0 0 0\n`; // also ahhhhh
                
                if (field === 8) {
                    var stringE = "";
                } else {
                    var stringE = `FLD FIELD ${field}.0 200.0 0 0\nWAI WAITFOR 1800 0 1 0 0 0\n`; // also ahhhhh
                }

                return stringA + stringB + stringC + stringD + stringE;
            }

            function chainString(id, date, field) {
                return `CHN C:\\Users\\hmcph\\OneDrive\\Desktop\\FeRh Summer 2024\\R vs Theta\\${id}\Sequences\\${date} FeRh ${id} - R vs Theta - 100K, 50K, 10K - ${field}T.seq`;
            }

            function logString(id, date, field, temp) {
                return `LOG 0 1 0.25 8389583 0 0 0 \"C:\\Users\\hmcph\\OneDrive\\Desktop\\FeRh Summer 2024\\R vs Theta\\${id}\\Data\\${date} FeRh ${id} - R vs Theta - ${temp}K - ${field}T - fast.dat\" \"${date} FeRh ${id} - R vs Theta - ${temp}K - ${field}T - fast\" \"\" \"\"`;
            }
            
            const contentA = generalInitiate(sampleField) + logString(sampleID, formattedDate, sampleField, 400) + measureString + initiateMeasurement(sampleField, 200) + logString(sampleID, formattedDate, Field, 200) + measureString + initiateMeasurement(sampleField, 150) + logString(sampleID, formattedDate, sampleField, 150) + measureString + chainString(sampleID, formattedDate, sampleField);

            const blob = new Blob([contentA], { type: 'text/plain' });

            const title = `${formattedDate} FeRh ${sampleID} - R vs Theta - 400K, 200K, 150K - ${sampleField}T - fast`;

            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = title + ".txt";

            a.click();

            URL.revokeObjectURL(a.href);








            // // Get the content from the textarea
            // const content = document.getElementById('textContent').value;

            // // Create a Blob from the content
            // const blob = new Blob([content], { type: 'text/plain' });

            // // Create a link element
            // const a = document.createElement('a');
            // a.href = URL.createObjectURL(blob);
            // a.download = 'myfile.txt'; // Default filename

            // // Programmatically click the link to trigger the download
            // a.click();

            // // Cleanup
            // URL.revokeObjectURL(a.href);


        }
    </script>
</body>
</html>
